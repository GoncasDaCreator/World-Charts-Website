<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    .navbar {
      background-color: rgba(0, 0, 0, 0.36);
      padding: 10px;
    }

    .navbar-brand {
      font-weight: bold;
    }

    
  </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Charts</title>
<!--Jquery Link-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
<!--Highchart Links-->
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/modules/treemap.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
<!--Bootstrap Links-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<!--Navigation Bar-->
    <nav class="navbar" alt="Navigation Bar">
      <div class="container-fluid">
        <a class="navbar-brand" href="#" alt="Title: World Charts">World Charts</a>
        <a href="https://www.uib.es/es/">
          <img src="imgs/UIB.png", alt="Link to the UIB website", width="20%", height="20%">
        </a>
        <a href="http://localhost/phpmyadmin/index.php?route=/database/structure&db=world">
          <img src="imgs/favicon.ico", alt="Link to the database", width="50%" , height="50%">
        </a>
    </nav>

    <!--Continent selection-->
    <div class="container mt-3" alt="A Table to choose which continent to be in the charts">
      <label for="continentSelect">Select Continent:</label>
      <select id="continentSelect" class="form-control" onchange="updateCharts(this.value)">
        <option value="Asia" alt="Asia">Asia</option>
        <option value="Europe" alt="Europe">Europe</option>
        <option value="Africa" alt="Africa">Africa</option>
        <option value="North America" alt="North America">North America</option>
        <option value="South America" alt="South America">South America</option>
        <option value="Oceania" alt="Oceania">Oceania</option>
      </select>
    </div>

  

</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<div class="container-fluid" id="container1" style="width: 100%; height: 400px;" alt="First Chart"></div>
<div class="container-fluid" id="container2" style="width: 100%; height: 400px;" alt="Second Chart"></div>
<div class="container-fluid" id="container3" style="width: 100%; height: 600px;" alt="Third Chart"></div>

<script>
  
//Population Chart

  function fetchData_Population(continent) {
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            const data = JSON.parse(xhr.responseText);
            const countries = [];
            const population = [];
            const outputDiv = document.getElementById("container1");
            outputDiv.innerHTML = "";
            data.forEach(Country => {
                countries.push(Country.Name);
                population.push(parseInt(Country.Population));
            });
            Highcharts.chart('container1', {
              chart: { type: 'bar' },
              title: { text: `Top 20 Most populated Countries in ${continent}` },
              accessibility: {
                description: 'Countries by population density',
                rangeDescription: 'Range: 60 millions to 1.2 billions of people'},
              xAxis: { categories: countries },
              yAxis: { title: { text: 'Population' } },
              series: [{ name: 'Population', data: population }]
          });
        }
    };

    // Configure the request
    xhr.open("GET", `http://localhost/population.php?continent=${continent}`, true);

    // Send the request
    xhr.send();
}    

//Life Expectancy Chart

  

  function fetchData_Life(continent) {
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            const data = JSON.parse(xhr.responseText);
            const countries = [];
            const life = [];
            const outputDiv = document.getElementById("container2");
            outputDiv.innerHTML = ""; 
            data.forEach(Country => {
                countries.push(Country.Name);
                life.push(parseInt(Country.LifeExpectancy));
            });
            Highcharts.chart('container2', {
              chart: { type: 'column', zooming: {type: 'y'}},
              title: { text: `Top 20 Life Expectancy Countries in ${continent}`},
              accessibility: {
                description: 'Countries listed by Life Expectancy',
                rangeDescription: 'Range: 78 years to 83 years.'},
              xAxis: { categories: countries, title: {text: null }, accessibility: { description: 'Countries'}},
              yAxis: { min: 0, tickInterval: 2, labels: { overflow: 'justify', format: '{value}'}},
              plotOptions: { column: {dataLabels: {enabled: true, format: '{y} Years'}}},
              tooltip: {valueSuffix: ' Years',stickOnContact: true,backgroundColor: 'rgba(255, 255, 255, 0.93)'},
              legend: {enabled: false},
              series: [{ name: 'Life Expectancy', data: life,borderColor: '#5997DE'}]
            });
            
        }
    };
    xhr.open("GET", `http://localhost/life_expectancy.php?continent=${continent}`, true);
    xhr.send();
}    

//Surface Area Chart

 

  function fetchData_Surface(continent) {
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            const data = JSON.parse(xhr.responseText);
            const countries = [];
            const outputDiv = document.getElementById("container3");
            outputDiv.innerHTML = "";
            data.forEach(Country => {
              const name = Country.Name;
              const area = parseInt(Country.SurfaceArea);
              const obj = { name: name, sliced: true, selected: false, y: area};
              countries.push(obj);
            });
            Highcharts.chart('container3', {
              colors: ['#01BAF2', '#f6fa4b', '#FAA74B', '#baf201', '#f201ba'],
              chart: {
                type: 'pie'
              },
              title: {
                text: `Top 20 Biggest Countries in ${continent}`
              },
              tooltip: {
                valueSuffix: 'km^2'
              },
              accessibility: {
                description: 'Countries organized by surface area',
                rangeDescription: 'Range: 1.5 to 17 millions of kilometers per square.'},
              plotOptions: {
                pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  dataLabels: {
                    enabled: true,
                    format: '{point.name}: {point.y:.1f}'
                  },
                  showInLegend: true
                }
              },
              series: [
                {
                  name: 'Area',
                  colorByPoint: true,
                  data: countries,
                }
              ]
            });
            
            
           
        }
    };
    xhr.open("GET", `http://localhost/surface_area.php?continent=${continent}`, true);
    xhr.send();
}    

// Function to update the charts based on the selected continent
function updateCharts(continent) {
  fetchData_Population(continent);
  fetchData_Life(continent);
  fetchData_Surface(continent);
}

// Initialize the charts with "Asia"
document.addEventListener('DOMContentLoaded', function () {
  updateCharts("Asia"); 
});



</script>
</body>
</html>
